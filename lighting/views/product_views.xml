<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright NuoBiT Solutions - Eric Antones <eantones@nuobit.com>
     Copyright NuoBiT Solutions - Kilian Niubo <kniubo@nuobit.com>
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl) -->
<odoo>
    <record
        id="product_action_parent_optional_accessory_product"
        model="ir.actions.act_window"
    >
        <field name="name">Parent products as recommended accessories</field>
        <field name="res_model">lighting.product</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('optional_ids', '=', active_id)]</field>
        <field name="context">{'default_optional_ids': [(4, active_id, False)]}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create the first product</p>
        </field>
    </record>
    <record
        id="product_action_parent_required_accessory_product"
        model="ir.actions.act_window"
    >
        <field name="name">Parent products as mandatory accessories</field>
        <field name="res_model">lighting.product</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('required_ids', '=', active_id)]</field>
        <field name="context">{'default_required_ids': [(4, active_id, False)]}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create the first product</p>
        </field>
    </record>
    <record model="ir.ui.view" id="product_form_view">
        <field name="name">product.form</field>
        <field name="model">lighting.product</field>
        <field name="arch" type="xml">
            <form string="Product Form">
                <header>
                    <field
                        name="state"
                        widget="statusbar"
                        clickable="True"
                        options="{'fold_field': 'fold'}"
                        statusbar_visible="draft,to_review,published"
                    />
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button
                            type="action"
                            class="oe_stat_button"
                            icon="fa-filter"
                            name="%(product_action_parent_optional_accessory_product)d"
                            attrs="{'invisible': [('parent_optional_accessory_product_count', '=', 0)]}"
                        >
                            <field
                                string="P. rec. acc."
                                name="parent_optional_accessory_product_count"
                                help="Products where one of its recommended accessories is the current product"
                                widget="statinfo"
                            />
                        </button>
                        <button
                            type="action"
                            class="oe_stat_button"
                            icon="fa-filter"
                            name="%(product_action_parent_required_accessory_product)d"
                            attrs="{'invisible': [('parent_required_accessory_product_count', '=', 0)]}"
                        >
                            <field
                                string="P. mand. acc."
                                name="parent_required_accessory_product_count"
                                help="Products where one of its mandatory accessories is the current product"
                                widget="statinfo"
                            />
                        </button>
                        <button
                            type="action"
                            class="oe_stat_button"
                            icon="fa-files-o"
                            name="%(attachment_list_action)d"
                        >
                            <field
                                string="Attachments"
                                name="attachment_count"
                                widget="statinfo"
                            />
                        </button>
                    </div>
                    <field name="image_medium" class="oe_avatar" widget="image" />
                    <div class="oe_title">
                        <h1>
                            <field
                                name="reference"
                                placeholder="Reference"
                                attrs="{'readonly': [('state', 'not in', ('draft', 'to_review'))]}"
                            />
                        </h1>
                    </div>
                    <group>
                        <field name="description" />
                        <field name="description_manual" />
                    </group>
                    <group>
                        <field name="product_group_id" />
                    </group>
                    <group>
                        <field name="ean" />
                        <field
                            name="catalog_ids"
                            widget="many2many_tags"
                            options="{'color_field': 'color'}"
                        />
                        <field
                            name="category_id"
                            attrs="{'required': [('state', '=', 'published')]}"
                        />
                        <field
                            name="family_ids"
                            widget="many2many_tags"
                            attrs="{'required': [('state', '=', 'published')]}"
                        />
                        <field name="model_id" />
                    </group>
                    <group>
                        <field name="is_composite" />
                        <field
                            name="parents_brand_ids"
                            widget="many2many_tags"
                            options="{'color_field': 'color'}"
                        />
                    </group>
                    <group>
                        <field name="configurator" />
                    </group>
                    <group>
                        <field name="sequence" />
                    </group>
                    <notebook>
                        <page string="Description">
                            <group>
                                <field
                                    name="location_ids"
                                    widget="many2many_tags"
                                    options="{'color_field': 'color'}"
                                    attrs="{'required': [('state', '=', 'published')]}"
                                />
                                <field
                                    name="installation_ids"
                                    widget="many2many_tags"
                                />
                                <field name="application_ids" widget="many2many_tags" />
                                <field name="finish_id" />
                                <field name="finish2_id" />
                                <field name="ral_id" />
                                <field
                                    name="body_material_ids"
                                    widget="many2many_tags"
                                />
                                <field
                                    name="lampshade_material_ids"
                                    widget="many2many_tags"
                                />
                                <field
                                    name="diffusor_material_ids"
                                    widget="many2many_tags"
                                />
                                <field
                                    name="frame_material_ids"
                                    widget="many2many_tags"
                                />
                                <field
                                    name="reflector_material_ids"
                                    widget="many2many_tags"
                                />
                                <field
                                    name="blade_material_ids"
                                    widget="many2many_tags"
                                />
                                <field name="sealing_id" />
                                <field name="sealing2_id" />
                                <field name="ik" />
                                <field name="static_pressure" />
                                <field name="dynamic_pressure" />
                                <field name="dynamic_pressure_velocity" />
                                <field name="corrosion_resistance" />
                                <field name="technical_comments" widget="text" />
                            </group>
                        </page>
                        <page string="Electrics">
                            <group>
                                <field name="protection_class_id" />
                                <field name="frequency_id" />
                                <field name="dimmable_ids" widget="many2many_tags" />
                            </group>
                            <group>
                                <field name="input_voltage_id" />
                                <field name="input_current" />
                                <field name="output_voltage_id" />
                                <field name="output_current" />
                                <field name="power_factor_min" />
                                <label for="total_wattage" />
                                <div>
                                    <field
                                        name="total_wattage"
                                        style="width:15%;"
                                        attrs="{'readonly': [('total_wattage_auto', '=', True)]}"
                                    />
                                    <field
                                        name="total_wattage_auto"
                                        style="margin-left:10px;width:15px;"
                                    />
                                    <label
                                        for="total_wattage_auto"
                                        style="font-weight:bold;"
                                    />
                                </div>
                            </group>
                            <group>
                                <field
                                    name="auxiliary_equipment_ids"
                                    widget="many2many_tags"
                                />
                                <field name="auxiliary_equipment_model_ids">
                                    <tree editable="bottom">
                                        <field name="reference" />
                                        <field name="brand_id" />
                                        <field name="date" />
                                    </tree>
                                </field>
                                <field
                                    name="auxiliary_equipment_model_alt"
                                    widget="text"
                                />
                            </group>
                            <group col="6">
                                <field name="usb_ports" />
                                <field
                                    name="usb_voltage"
                                    attrs="{'invisible': [('usb_ports', '=', 0)], 'required': [('usb_ports', '!=', 0)]}"
                                />
                                <field
                                    name="usb_current"
                                    attrs="{'invisible': [('usb_ports', '=', 0)], 'required': [('usb_ports', '!=', 0)]}"
                                />
                                <field name="charger_connector_type_id" />
                            </group>
                            <group>
                                <field name="sensor_ids" widget="many2many_tags" />
                                <field name="rechargeable_type" />
                                <field name="battery_autonomy" />
                                <field name="battery_charge_time" />
                                <field name="battery_charge_capacity" />
                                <field name="battery_output_voltage" />
                                <field name="surface_temperature" />
                                <field name="operating_temperature_min" />
                                <field name="operating_temperature_max" />
                                <field name="glow_wire_temperature" />
                                <field name="power_switches" />
                            </group>
                        </page>
                        <page string="Lighting">
                            <group>
                                <field name="ugr_max" />
                                <field name="lifetime" />
                                <field name="led_lifetime_l" />
                                <field name="led_lifetime_b" />
                            </group>
                        </page>
                        <page string="Physical">
                            <group>
                                <field name="weight" />
                                <field name="dimension_ids">
                                    <tree editable="bottom">
                                        <field name="sequence" widget="handle" />
                                        <field name="type_id" />
                                        <field name="value" />
                                    </tree>
                                </field>
                                <field name="cutting_length" />
                                <field name="cable_outlets" />
                                <field name="lead_wire_length" />
                                <field name="inclination_angle_max" />
                                <field name="rotation_angle_max" />
                                <field name="recessing_box_included" />
                                <field name="recess_dimension_ids">
                                    <tree editable="bottom">
                                        <field name="sequence" widget="handle" />
                                        <field name="type_id" />
                                        <field name="value" />
                                    </tree>
                                </field>
                                <field name="ecorrae_category_id" />
                                <field name="ecorrae2_category_id" />
                                <field name="ecorrae" />
                                <field name="ecorrae2" />
                                <field name="periodic_maintenance" />
                                <field name="anchorage_included" />
                                <field name="post_included" />
                                <field name="post_with_inspection_chamber" />
                                <field name="emergency_light" />
                                <field name="average_emergency_time" />
                                <field name="flammable_surfaces" />
                                <field name="photobiological_risk_group_id" />
                                <field name="mechanical_screwdriver" />
                                <field name="fan_blades" />
                                <field name="fan_control" />
                                <field name="fan_noise_level" />
                                <field name="fan_reverse_direction" />
                                <field name="fan_wattage_ids">
                                    <tree editable="bottom">
                                        <field name="wattage" />
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="Sources">
                            <group string="Source groups">
                                <field name="source_count" />
                            </group>
                            <group>
                                <field name="source_ids" nolabel="1" colspan="2">
                                    <tree>
                                        <field name="sequence" widget="handle" />
                                        <field name="relevance" />
                                        <field name="num" />
                                        <field name="lampholder_id" />
                                        <field name="line_display" />
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="Beams">
                            <group string="Beam groups">
                                <field name="beam_count" />
                            </group>
                            <group>
                                <field name="beam_ids" nolabel="1" colspan="2">
                                    <tree>
                                        <field name="sequence" widget="handle" />
                                        <field name="num" />
                                        <field
                                            name="photometric_distribution_ids"
                                            widget="many2many_tags"
                                            options="{'color_field': 'color'}"
                                        />
                                        <field name="dimensions_display" />
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="Notes">
                            <group string="Notes">
                                <field name="note_ids" nolabel="1" colspan="2">
                                    <tree editable="bottom">
                                        <field name="sequence" widget="handle" />
                                        <field name="note_id" />
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="Logistics">
                            <group>
                                <field name="tariff_item" />
                                <field name="assembler_id" />
                            </group>
                            <group string="Suppliers">
                                <field name="supplier_ids" nolabel="1" colspan="2">
                                    <tree editable="bottom">
                                        <field name="sequence" widget="handle" />
                                        <field name="supplier_id" />
                                        <field name="reference" />
                                    </tree>
                                </field>
                            </group>
                            <group col="4">
                                <group colspan="2" string="IBox">
                                    <field name="ibox_weight" string="Weight (Kg)" />
                                    <field name="ibox_volume" string="Volume (cm³)" />
                                    <field name="ibox_length" string="Length (cm)" />
                                    <field name="ibox_width" string="Width (cm)" />
                                    <field name="ibox_height" string="Height (cm)" />
                                </group>
                                <group colspan="2" string="Masterbox">
                                    <field name="mbox_qty" string="Quantity" />
                                    <field name="mbox_weight" string="Weight (Kg)" />
                                    <field name="mbox_length" string="Length (cm)" />
                                    <field name="mbox_width" string="Width (cm)" />
                                    <field name="mbox_height" string="Height (cm)" />
                                </group>
                            </group>
                        </page>
                        <page string="Inventory">
                            <group colspan="4">
                                <group col="2">
                                    <group>
                                        <field name="available_qty" />
                                    </group>
                                    <group>
                                        <field name="onhand_qty" />
                                        <field name="commited_qty" />
                                        <field name="onorder_qty" />
                                        <field name="capacity_qty" />
                                    </group>
                                </group>
                                <group col="2">
                                    <group>
                                        <field name="stock_future_qty" />
                                        <field name="stock_future_date" />
                                    </group>
                                    <group>
                                        <field name="last_purchase_date" />
                                    </group>
                                </group>
                            </group>
                        </page>
                        <page string="Marketing" id="marketing_tab">
                            <group
                                attrs="{'invisible': [('state', '!=', 'published')]}"
                                col="2"
                            >
                                <group colspan="2">
                                    <group>
                                        <field name="state_marketing" string="Status" />
                                    </group>
                                    <group>
                                        <field name="on_request" />
                                        <field name="effective_date" />
                                    </group>
                                </group>
                                <group colspan="2">
                                    <group>
                                        <field name="price_currency_id" invisible="1" />
                                        <field
                                            name="price"
                                            widget="monetary"
                                            options="{'currency_field': 'price_currency_id'}"
                                        />
                                        <field name="cost_currency_id" invisible="1" />
                                        <field
                                            name="cost"
                                            widget="monetary"
                                            options="{'currency_field': 'cost_currency_id'}"
                                        />
                                    </group>
                                </group>
                                <group colspan="2">
                                    <field name="marketing_comments" widget="text" />
                                </group>
                            </group>
                            <group
                                attrs="{'invisible': [('state', '=', 'published')]}"
                                col="2"
                            >
                                <div>
                                    <p
                                    >The product is not yet approved to be able to define the marketing properties.
                                        Please approve the product first.
                                    </p>
                                </div>
                            </group>
                        </page>
                        <page string="Recommended accessories">
                            <group>
                                <field name="optional_ids" nolabel="1" colspan="2" />
                            </group>
                        </page>
                        <page
                            string="Mandatory accessories"
                            attrs="{'invisible': [('is_composite', '=', False)]}"
                        >
                            <group>
                                <field name="required_ids" nolabel="1" colspan="2" />
                            </group>
                        </page>
                        <page string="Substitutes">
                            <group>
                                <field name="substitute_ids" nolabel="1" colspan="2" />
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" />
                    <field name="activity_ids" />
                    <field name="message_ids" />
                </div>
            </form>
        </field>
    </record>
    <record model="ir.ui.view" id="product_tree_view">
        <field name="name">product.tree</field>
        <field name="model">lighting.product</field>
        <field name="arch" type="xml">
            <tree
                decoration-bf="state == 'draft'"
                decoration-it="state == 'to_review'"
                decoration-success="state_marketing == 'O'"
                decoration-info="state_marketing == 'N'"
                decoration-warning="state_marketing == 'ES'"
                decoration-danger="state_marketing == 'D'"
                decoration-muted="state_marketing == 'H'"
            >
                <field name="sequence" widget="handle" />
                <field name="reference" />
                <field name="description" />
                <field
                    name="catalog_ids"
                    widget="many2many_tags"
                    options="{'color_field': 'color'}"
                />
                <field
                    name="location_ids"
                    widget="many2many_tags"
                    options="{'color_field': 'color'}"
                />
                <field name="category_id" />
                <field name="family_ids" widget="many2many_tags" />
                <field name="state" invisible="1" />
                <field name="state_marketing" />
                <field name="available_qty" />
            </tree>
        </field>
    </record>
    <record id="product_kanban_view" model="ir.ui.view">
        <field name="name">prouct.kanban</field>
        <field name="model">lighting.product</field>
        <field name="arch" type="xml">
            <kanban class="o_res_partner_kanban">
                <field name="id" />
                <field name="reference" />
                <field name="description" />
                <field name="image_small" />
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_image">
                                <t t-if="record.image_small.raw_value">
                                    <img
                                        t-att-src="kanban_image('lighting.product', 'image_small', record.id.raw_value)"
                                        t-att-alt="record.id.value"
                                    />
                                </t>
                                <t t-if="!record.image_small.raw_value">
                                    <img
                                        t-att-src='_s + "/web/static/src/img/placeholder.png"'
                                        t-att-alt="record.id.value"
                                    />
                                </t>
                            </div>
                            <div class="oe_kanban_details">
                                <strong>
                                    <field name="reference" />
                                </strong>
                                <div>
                                    <field name="description" />
                                </div>
                                <div class="o_kanban_tags_section">
                                    <field name="catalog_ids" />
                                </div>
                                <div class="o_kanban_tags_section">
                                    <field name="family_ids" />
                                </div>
                                <div>
                                    <field name="product_group_id" />
                                </div>
                                <div>
                                    <field name="category_id" />
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    <record id="product_energyefficiency_action_product" model="ir.actions.act_window">
        <field name="name">Product</field>
        <field name="res_model">lighting.product</field>
        <field name="view_mode">tree,kanban,form</field>
        <field
            name="domain"
        >[('source_ids.line_ids.efficiency_ids', 'in', [active_id])]</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create the first product</p>
        </field>
    </record>
    <record id="product_dimmable_action_product" model="ir.actions.act_window">
        <field name="name">Product</field>
        <field name="res_model">lighting.product</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('dimmable_ids', '=', active_id)]</field>
        <field name="context">{'default_dimmable_ids': [(4, active_id, False)]}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create the first Product</p>
        </field>
    </record>
    <record
        id="product_auxiliaryequipment_action_product"
        model="ir.actions.act_window"
    >
        <field name="name">Product</field>
        <field name="res_model">lighting.product</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('auxiliary_equipment_ids', '=', active_id)]</field>
        <field
            name="context"
        >{'default_auxiliary_equipment_ids': [(4, active_id, False)]}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create the first Product</p>
        </field>
    </record>
    <record id="product_sensor_action_product" model="ir.actions.act_window">
        <field name="name">Product</field>
        <field name="res_model">lighting.product</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('sensor_ids', '=', active_id)]</field>
        <field name="context">{'default_sensor_ids': [(4, active_id, False)]}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create the first Product</p>
        </field>
    </record>
    <record id="product_assembler_action_product" model="ir.actions.act_window">
        <field name="name">Product</field>
        <field name="res_model">lighting.product</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('assembler_id', '=', active_id)]</field>
        <field name="context">{'default_assembler_id': [(4, active_id, False)]}</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create the first Product</p>
        </field>
    </record>

    <record model="ir.ui.view" id="lighting_product_view">
        <field name="name">lighting.product.search</field>
        <field name="model">lighting.product</field>
        <field name="arch" type="xml">
            <search>
                <field
                    name="reference"
                    string="Product"
                    filter_domain="['|', '|', '|', '|', '|', '|', ('reference','ilike',self), ('description','ilike',self), ('ean','ilike',self), ('catalog_ids','ilike',self), ('location_ids','ilike',self), ('family_ids','ilike',self), ('category_id','ilike',self)]"
                />
                <field
                    name="attachment_ids"
                    string="Attachment type"
                    filter_domain="[('attachment_ids.type_id.code','=',self)]"
                />
                <field name="reference" />
                <field name="description" />
                <field name="ean" />
                <field name="catalog_ids" />
                <field name="location_ids" />
                <field name="category_id" />
                <field name="family_ids" />
                <field name="installation_ids" />
                <field name="application_ids" />
                <field name="dimmable_ids" />
                <field
                    name="body_material_ids"
                    string="=Material code"
                    filter_domain="['|', '|', '|', '|', '|', ('body_material_ids.code','=ilike',self), ('diffusor_material_ids.code','=ilike',self), ('frame_material_ids.code','=ilike',self), ('reflector_material_ids.code','=ilike',self), ('blade_material_ids.code','=ilike',self), ('lampshade_material_ids.code','=ilike',self)]"
                />
                <separator />
                <filter
                    string="Online"
                    name="online"
                    domain="[('state_marketing', '=', 'O')]"
                />
                <filter
                    string="New"
                    name="novelty"
                    domain="[('state_marketing', '=', 'N')]"
                />
                <filter
                    string="Cataloged"
                    name="cataloged"
                    domain="[('state_marketing', '=', 'C')]"
                />
                <filter
                    string="Until end of stock"
                    name="until_end_stock"
                    domain="[('state_marketing', '=', 'ES')]"
                />
                <filter
                    string="Until end of stock (historical)"
                    name="until_end_stock_historical"
                    domain="[('state_marketing', '=', 'ESH')]"
                />
                <filter
                    string="Discontinued"
                    name="discontinued"
                    domain="[('state_marketing', '=', 'D')]"
                />
                <filter
                    string="Historical"
                    name="historical"
                    domain="[('state_marketing', '=', 'H')]"
                />
                <separator />
                <filter
                    string="Draft"
                    name="draft"
                    domain="[('state', '=', 'draft')]"
                />
                <filter
                    string="Published"
                    name="published"
                    domain="[('state','=', 'published')]"
                />
                <filter
                    string="To review"
                    name="to_review"
                    domain="[('state','=', 'to_review')]"
                />
                <separator />
                <!--                TODO: stock available don't exist -->
                <!--                <filter-->
                <!--                    string="With stock"-->
                <!--                    name="with_stock_available"-->
                <!--                    domain="[('stock_available', '!=', 0)]"-->
                <!--                />-->
                <!--                <filter-->
                <!--                    string="Without stock"-->
                <!--                    name="without_stock_available"-->
                <!--                    domain="[('stock_available', '=', 0)]"-->
                <!--                />-->
                <separator />
                <filter
                    string="Composite products"
                    name="is_composite"
                    domain="[('is_composite', '=', True)]"
                />
                <filter
                    string="Recommended accessories"
                    name="recommended_accessories"
                    domain="[('is_optional_accessory', '=', True)]"
                />
                <filter
                    string="Mandatory accessories"
                    name="mandatory_accessories"
                    domain="[('is_required_accessory', '=', True)]"
                />
                <separator />
                <filter
                    string="With configurator"
                    name="with_configurator"
                    domain="[('configurator', '=', True)]"
                />
                <filter
                    string="Without configurator"
                    name="without_configurator"
                    domain="[('configurator', '=', False)]"
                />
                <group expand="0" string="Group By">
                    <filter
                        string="State"
                        name="groupby_state"
                        domain="[]"
                        context="{'group_by': 'state'}"
                    />
                    <filter
                        string="Marketing status"
                        name="groupby_state_marketing"
                        domain="[]"
                        context="{'group_by': 'state_marketing'}"
                    />
                    <filter
                        string="Category"
                        name="groupby_category"
                        domain="[]"
                        context="{'group_by': 'category_id'}"
                    />
                    <filter
                        string="Group"
                        name="groupby_group"
                        domain="[]"
                        context="{'group_by': 'product_group_id'}"
                    />
                    <filter
                        string="Is composite"
                        name="groupby_is_composite"
                        domain="[]"
                        context="{'group_by': 'is_composite'}"
                    />
                    <filter
                        string="Configurator"
                        name="groupby_configurator"
                        domain="[]"
                        context="{'group_by': 'configurator'}"
                    />
                </group>
            </search>
        </field>
    </record>
    <record model="ir.actions.act_window" id="product_list_action">
        <field name="name">Products</field>
        <field name="res_model">lighting.product</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">Create the first product
            </p>
        </field>
    </record>
</odoo>
